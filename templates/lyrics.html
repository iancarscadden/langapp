{% extends "layout.html" %}
{% block title %}{{ song }} by {{ artist }} - Lyrics{% endblock %}
{% block content %}
<div class="flex flex-col lg:flex-row items-start justify-center space-y-6 lg:space-y-0 lg:space-x-6">
    <!-- Lyrics Section -->
    <div class="w-full lg:w-2/3 bg-gray-800 p-6 rounded shadow-md animate-slide-in-up">
        <h2 class="text-2xl font-semibold mb-4">{{ song }} - {{ artist }}</h2>
        <pre id="lyrics" class="whitespace-pre-wrap text-gray-200">
{{ lyrics }}
        </pre>
    </div>

    <!-- Explanation Section -->
    <div class="w-full lg:w-1/3 bg-gray-800 p-6 rounded shadow-md">
        <h3 class="text-xl font-semibold mb-4">Explanation</h3>
        <p class="text-gray-400">Select any part of the lyrics to get an explanation.</p>
        <!-- The explanation modal is handled via JavaScript -->
    </div>
</div>

<!-- Explanation Modal -->
<div id="explanationModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
    <div class="bg-gray-800 p-6 rounded shadow-md max-w-lg w-full animate-zoom-in">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-2xl font-semibold">Explanation</h2>
            <button id="closeModal" class="text-gray-400 hover:text-white text-3xl leading-none">&times;</button>
        </div>
        <div id="explanationContent" class="text-gray-200">
            <!-- Explanation will be loaded here -->
        </div>
    </div>
</div>
{% endblock %}
{% block scripts %}
<script>
    const modal = document.getElementById('explanationModal');
    const explanationContent = document.getElementById('explanationContent');
    const closeModalButton = document.getElementById('closeModal');

    document.getElementById('lyrics').addEventListener('mouseup', function() {
        const selection = window.getSelection();
        const selectedText = selection.toString().trim();
        if (selectedText) {
            // Show modal
            modal.classList.remove('hidden');
            // Show loading spinner
            explanationContent.innerHTML = `
                <div class="text-center">
                    <svg class="animate-spin h-8 w-8 text-white mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
                    </svg>
                    <p class="mt-2">Loading...</p>
                </div>
            `;

            fetch('/explain', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ 'text': selectedText }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.explanation) {
                    explanationContent.innerText = data.explanation;
                } else {
                    explanationContent.innerText = 'Could not get explanation.';
                }
            })
            .catch(error => {
                console.error('Error:', error);
                explanationContent.innerText = 'An error occurred while fetching the explanation.';
            });
        }
    });

    closeModalButton.addEventListener('click', () => {
        modal.classList.add('hidden');
    });

    // Close modal when clicking outside the content
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.classList.add('hidden');
        }
    });
</script>
{% endblock %}
